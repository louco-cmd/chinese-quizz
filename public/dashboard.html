<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Home - Vocabulary App</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
<nav class="navbar navbar-expand-lg bg-primary navbar-dark">
  <div class="container-fluid d-flex justify-content-between">
    <!-- Titre -->
    <a class="navbar-brand text-white fw-bold" href="#">Vocabulary App</a>

    <!-- Bouton -->
    <div class="d-flex">
      <button id="collectionBtn" class="btn btn-outline-light w-auto">Voir ma collection</button>
    </div>
  </div>
</nav>

<section class="container mt-4 col-12 col-md-10 col-lg-6">
<ul class="nav nav-tabs tabs">
  <li class="nav-item">
    <a class="nav-link active tab" data-tab="add" href="#">Ajouter un mot</a>
  </li>
  <li class="nav-item">
    <a class="nav-link tab" data-tab="quiz" href="#">Quizz</a>
  </li>
</ul>

<div id="add" class="tab-content">
  <h2 class="my-4">Ajouter un mot</h2>
  <form id="addForm" class="p-4 bg-light rounded shadow-sm">
    
    <!-- Caractère chinois -->
    <div class="mb-3">
      <label for="chinese" class="form-label">Caractère chinois</label>
      <input 
        type="text" 
        id="chinese" 
        class="form-control" 
        required
      >
    </div>

    <!-- Pinyin -->
    <div class="mb-3">
      <label for="pinyin" class="form-label">Pinyin</label>
      <input 
        type="text" 
        id="pinyin" 
        class="form-control"
      >
    </div>

    <!-- Anglais -->
    <div class="mb-3">
      <label for="english" class="form-label">Anglais</label>
      <input 
        type="text" 
        id="english" 
        class="form-control" 
        required
      >
    </div>

    <!-- Description -->
    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea 
        id="description" 
        class="form-control"
        rows="3"
      ></textarea>
    </div>

    <!-- Bouton -->
    <div class="d-grid">
      <button type="submit" class="btn btn-primary">
        Ajouter
      </button>
    </div>
  </form>

  <div id="addResult" class="mt-3"></div>
</div>

<div id="quiz" class="tab-content" style="display:none;">
  <h2 class="my-4">Quiz Setup</h2>
  <form id="quizForm" class="p-4 bg-light rounded shadow-sm">

    <!-- Type de quiz -->
    <div class="mb-3">
      <label for="quizType" class="form-label">Type de quiz</label>
      <select id="quizType" class="form-select">
        <option value="englishToPinyin">Anglais → Pinyin</option>
        <option value="englishToChinese">Anglais → Caractère</option>
      </select>
    </div>

    <!-- Nombre de mots -->
    <div class="mb-3">
      <label for="quizCount" class="form-label">Nombre de mots</label>
      <select id="quizCount" class="form-select">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="40">40</option>
        <option value="all">Tous</option>
      </select>
    </div>

    <!-- Bouton -->
    <div class="d-grid">
      <button type="submit" class="btn btn-primary">Lancer le quiz</button>
    </div>

  </form>
</div>

</section>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>

const chineseInput = document.getElementById('chinese');
const pinyinInput = document.getElementById('pinyin');
const englishInput = document.getElementById('english');
const messageDiv = document.getElementById('addResult'); // déjà dans ton HTML

// -----------------------------
// Tabs
// -----------------------------
const tabs = document.querySelectorAll('.tab');
tabs.forEach(tab => {
  tab.onclick = () => {
    // Active la tab
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');

    // Affiche le contenu correspondant
    document.querySelectorAll('.tab-content').forEach(tc => tc.style.display = 'none');
    document.getElementById(tab.dataset.tab).style.display = 'block';
  };
});

// -----------------------------
// Add Word Form
// -----------------------------
const addForm = document.getElementById('addForm');
addForm.onsubmit = async (e) => {
  e.preventDefault();

  const payload = {
    chinese: document.getElementById('chinese').value,
    pinyin: document.getElementById('pinyin').value,
    english: document.getElementById('english').value,
    description: document.getElementById('description').value
  };

  try {
    const res = await fetch('/ajouter', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const data = await res.json();

    if (data.success) {
      document.getElementById('addResult').textContent = '✅ Mot ajouté !';
      addForm.reset();
    } else {
      document.getElementById('addResult').textContent = `❌ ${data.message}`;
    }

  } catch(err) {
    document.getElementById('addResult').textContent = '❌ Erreur serveur';
  }
};

chineseInput.addEventListener("blur", async () => {
  const chinese = chineseInput.value.trim();
  if (!chinese) return;

  try {
    const res = await fetch(`/check-mot/${encodeURIComponent(chinese)}`);
    const data = await res.json();

    if (data.exists) {
      // Remplir les champs automatiquement
      pinyinInput.value = data.mot.pinyin || "";
      englishInput.value = data.mot.english || "";
      messageDiv.textContent = "Mot existant, champs remplis automatiquement";
      messageDiv.style.color = "green";
    } else {
      pinyinInput.value = "";
      englishInput.value = "";
      messageDiv.textContent = "Nouveau mot à intégrer dans la base";
      messageDiv.style.color = "orange";
    }
  } catch (err) {
    messageDiv.textContent = "Erreur lors de la vérification";
    messageDiv.style.color = "red";
  }
});
// -----------------------------
// Quiz Setup Form
// -----------------------------
const quizForm = document.getElementById('quizForm');
quizForm.onsubmit = (e) => {
  e.preventDefault();

  const type = document.getElementById('quizType').value;  // englishToPinyin / englishToChinese
  const count = document.getElementById('quizCount').value; // nombre de mots

  // Redirection vers la page quiz correspondante
  if (type === 'englishToPinyin') {
    window.location.href = `quiz-pinyin.html?count=${count}`;
  } else {
    window.location.href = `quiz-character.html?count=${count}`;
  }
};

// -----------------------------
// Collection Button
// -----------------------------
document.getElementById('collectionBtn').onclick = () => {
  window.location.href = 'collection.html';
};
</script>


</body>
</html>
