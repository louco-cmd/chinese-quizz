<div class="d-flex justify-content-between align-items-center bg-primary text-white p-3 position-relative">
    <!-- Logo/Titre -->
    <span class="fs-3 fw-bold user-select-all" style="cursor: pointer;" onclick="window.location='/dashboard'">
        加油！
    </span>
    
    <!-- Zone de notifications -->
    <div id="header-notifications" class="position-absolute top-100 start-50 translate-middle-x mt-2" 
         style="z-index: 9999; min-width: 300px; display: none;">
        <!-- Les notifications seront injectées ici -->
    </div>
    
    <!-- Indicateur de notifications (optionnel) -->
    <div id="notification-indicator" class="position-absolute top-0 end-0 mt-1 me-1" style="display: none;">
        <span class="badge bg-danger rounded-pill" id="notification-count">0</span>
    </div>
</div>

<!-- Style pour les notifications -->
<style>
.notification-item {
    animation: slideDown 0.3s ease-out;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-left: 4px solid #0d6efd;
}

.notification-success {
    border-left-color: #198754;
}

.notification-warning {
    border-left-color: #ffc107;
}

.notification-error {
    border-left-color: #dc3545;
}

.notification-info {
    border-left-color: #0dcaf0;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideUp {
    from {
        opacity: 1;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        transform: translateY(-10px);
    }
}

.notification-exit {
    animation: slideUp 0.3s ease-out forwards;
}
</style>

<script>
// Gestionnaire de notifications global
class NotificationManager {
    constructor() {
        this.notifications = [];
        this.maxNotifications = 3;
        this.autoHideDelay = 5000; // 5 secondes
        this.init();
    }
    
    init() {
        // Écouter les événements de notification
        document.addEventListener('showNotification', (e) => {
            this.show(e.detail);
        });
    }
    
    show(notification) {
        const notificationData = {
            id: Date.now() + Math.random(),
            type: notification.type || 'info',
            title: notification.title,
            message: notification.message,
            duration: notification.duration || this.autoHideDelay,
            action: notification.action
        };
        
        this.notifications.unshift(notificationData);
        this.render();
        
        // Auto-hide si une durée est spécifiée
        if (notificationData.duration > 0) {
            setTimeout(() => {
                this.hide(notificationData.id);
            }, notificationData.duration);
        }
    }
    
    hide(notificationId) {
        const notificationElement = document.querySelector(`[data-notification-id="${notificationId}"]`);
        if (notificationElement) {
            notificationElement.classList.add('notification-exit');
            setTimeout(() => {
                this.notifications = this.notifications.filter(n => n.id !== notificationId);
                this.render();
            }, 300);
        }
    }
    
    hideAll() {
        const container = document.getElementById('header-notifications');
        if (container) {
            container.querySelectorAll('.notification-item').forEach(item => {
                item.classList.add('notification-exit');
            });
            setTimeout(() => {
                this.notifications = [];
                this.render();
            }, 300);
        }
    }
    
    render() {
        const container = document.getElementById('header-notifications');
        const indicator = document.getElementById('notification-indicator');
        const countElement = document.getElementById('notification-count');
        
        if (!container) return;
        
        // Limiter le nombre de notifications affichées
        const notificationsToShow = this.notifications.slice(0, this.maxNotifications);
        
        if (notificationsToShow.length > 0) {
            container.innerHTML = notificationsToShow.map(notif => `
                <div class="card notification-item notification-${notif.type} mb-2" 
                     data-notification-id="${notif.id}">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h6 class="card-title mb-1">${notif.title}</h6>
                                <p class="card-text small mb-0">${notif.message}</p>
                                ${notif.action ? `
                                    <button class="btn btn-sm btn-outline-${notif.type} mt-2" 
                                            onclick="window.notificationManager.handleAction('${notif.action}')">
                                        ${notif.action.label || 'Action'}
                                    </button>
                                ` : ''}
                            </div>
                            <button type="button" class="btn-close btn-close-sm ms-2" 
                                    onclick="window.notificationManager.hide('${notif.id}')"
                                    aria-label="Fermer"></button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.style.display = 'block';
            
            // Mettre à jour l'indicateur
            if (indicator && countElement) {
                indicator.style.display = 'block';
                countElement.textContent = this.notifications.length;
            }
        } else {
            container.style.display = 'none';
            if (indicator) {
                indicator.style.display = 'none';
            }
        }
    }
    
    handleAction(action) {
        switch (action.type) {
            case 'redirect':
                window.location.href = action.url;
                break;
            case 'reload':
                window.location.reload();
                break;
            case 'callback':
                if (typeof action.callback === 'function') {
                    action.callback();
                }
                break;
            case 'duel_invite':
                // Exemple pour une invitation de duel
                if (action.duelId) {
                    window.location.href = `/duel-play/${action.duelId}`;
                }
                break;
        }
        this.hideAll();
    }
    
    // Méthodes utilitaires pour les types courants
    success(title, message, options = {}) {
        this.show({ type: 'success', title, message, ...options });
    }
    
    error(title, message, options = {}) {
        this.show({ type: 'error', title, message, ...options });
    }
    
    warning(title, message, options = {}) {
        this.show({ type: 'warning', title, message, ...options });
    }
    
    info(title, message, options = {}) {
        this.show({ type: 'info', title, message, ...options });
    }
}

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
    window.notificationManager = new NotificationManager();
});

// Fonctions globales pour un usage facile
function showNotification(notification) {
    const event = new CustomEvent('showNotification', { detail: notification });
    document.dispatchEvent(event);
}

function showSuccessNotification(title, message, options) {
    showNotification({ type: 'success', title, message, ...options });
}

function showErrorNotification(title, message, options) {
    showNotification({ type: 'error', title, message, ...options });
}

function showWarningNotification(title, message, options) {
    showNotification({ type: 'warning', title, message, ...options });
}

function showInfoNotification(title, message, options) {
    showNotification({ type: 'info', title, message, ...options });
}
</script>